{% extends 'base.html' %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h5 class="mb-0">Historial de Corridas</h5>
    <small class="text-muted">Ultimas 50 corridas del sistema</small>
  </div>
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-sm mb-0">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Tipo</th>
            <th>Folio</th>
            <th>Responsable</th>
            <th>Categoria</th>
            <th>Tienda</th>
            <th>Estado</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% if runs %}
            {% for r in runs %}
            <tr>
              <td>{{ r.created_at.strftime('%Y-%m-%d %H:%M') if r.created_at else '-' }}</td>
              <td>
                {% if r.run_type == 'sales_upload' %}
                  <span class="badge bg-info">Ventas</span>
                {% elif r.run_type == 'distribution' %}
                  <span class="badge bg-primary">Distribucion</span>
                {% elif r.run_type == 'forecast_v2' %}
                  <span class="badge bg-success">Forecast V2</span>
                {% else %}
                  <span class="badge bg-secondary">{{ r.run_type }}</span>
                {% endif %}
              </td>
              <td>{{ r.folio or '-' }}</td>
              <td>{{ r.responsable or '-' }}</td>
              <td>{{ r.categoria or '-' }}</td>
              <td>{{ r.store_filter or '-' }}</td>
              <td>
                {% if r.status == 'completed' %}
                  <span class="text-success">Completado</span>
                {% elif r.status == 'failed' %}
                  <span class="text-danger">Fallido</span>
                {% else %}
                  <span class="text-muted">{{ r.status }}</span>
                {% endif %}
              </td>
              <td>
                <a href="{{ url_for('view_run', run_id=r.run_id) }}" class="btn btn-sm btn-outline-primary">Ver</a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="8" class="text-muted p-3">No hay corridas registradas.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
